<html>
<head>
	<title>Javascript geo sample</title>
	<script src="javascript/geo-min.js" type="text/javascript" charset="utf-8"></script>
</head>	
<body>
	<b>Javascript geo sample</b>
	<script>
		if(geo_position_js.init()){
			geo_position_js.getCurrentPosition(success_callback,error_callback,{enableHighAccuracy:true});
		}
		else{
			alert("Functionality not available");
		}

		function success_callback(p)
		{
			var R = 6371; // km
			
			// Sample location, Campanile
			var lat1 = 37.871944;
			var long1  = -122.257778;
			
			// Retrieved using the geolocation API
			var lat2 = p.coords.latitude.toFixed(2);
			var long2 = p.coords.longitude.toFixed(2);
		
		  // Credit for JS to calculate Haversine formula, originally from http://www.movable-type.co.uk/scripts/latlong.html
			var dLat = (lat2-lat1).toRad();
			var dLon = (lon2-lon1).toRad();
			var lat1 = lat1.toRad();
			var lat2 = lat2.toRad();

			var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
			        Math.sin(dLon/2) * Math.sin(dLon/2) * Math.cos(lat1) * Math.cos(lat2); 
			var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); 
			var d = R * c;
			
			alert('alert!');
		}
		
		function error_callback(p)
		{
			alert('error='+p.message);
		}		
	</script>
	</body>
</html>
